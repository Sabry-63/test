!function(){var I,W,e,o,C,l=jQuery,s={url:null,action:null,multiUploading:!0,ifWrongFile:"show",maxFileSize:Number.POSITIVE_INFINITY,autoUpload:!1,fileNameMatcher:/.*/,fileMimeTypeMatcher:/.*/,wrapperForInvalidFile:function(e){return'<p>File: "'+this.files[e].name+"\" doesn't support</p>'"},validateEach:function(e){return!0},validateAll:function(e){return e},uploadBegin:function(e,n){},uploadEnd:function(e,n){},done:function(){},ajaxSettings:function(e,n,t){}},u=["nothing","error","show","ignore"],H=function(e){return this.message=e};H.prototype=new Error,W=function(e,n,t){return"function"==typeof e?e.apply(n,t):e},l.fn.withDropZone=function(n,t){var i,e,r,a;if("file"!==this.attr("type"))throw new H("You should call this method only on input[type=file] and send dropZone as argument");if(n instanceof l||(n=l(n)),t){for(e in s)r=s[e],t.hasOwnProperty(e)||(t[e]=r);if(t.ifWrongFile){if(u.indexOf(t.ifWrongFile)<0)throw new H('"ifWrongFile" should has one of these values: "nothing", "error", "show", "ignore"')}else t.ifWrongFile="show";t.formData||(t.multiUploading?t.formData=function(e,n,t){var i=new FormData;return i.set(this.name,n,t),i}:t.formData=function(e,n){for(var t,i=new FormData,r=t=0,a=e.length;0<=a?t<a:a<t;r=0<=a?++t:--t)i.append(this.name,e[r],n[r]);return i})}else t={};return a=[],i=this.get(0),n.on("dragenter",function(){return n.addClass("hover")}).on("dragleave",function(e){return n.removeClass("hover")}).on("dragover",function(e){return e.preventDefault()}).on("drop",function(e){return e.preventDefault(),i.files=e.originalEvent.dataTransfer.files,o(this,i,a,i.files,t)}).on("click",function(){return i.click()}),this.on("change",function(){return o(n[0],this,a,this.files,t)}),{upload:function(){for(var e=[],n=0,t=a.length;n<t;n++)e.push((0,a[n])());return e},autoUpload:function(e){return null==e?t.autoUpload:t.autoUpload=e},waitingToUploadCount:function(){return a.length}}},o=function(e,o,n,l,s){var t,u,h,i,d,r,c,f,a,p,m,g,v,w,y,F,x,T,D,E,L,M,N,U,b;if(n.length=0,e.classList.remove("hover"),e.classList.remove("drop"),e.classList.remove("error"),(L=e.getElementsByClassName("preview-container")[0])&&(L.innerHTML=""),0!==l.length){for(o.multiple||(l=l.slice(0,1)),t=(o.accept||"").split(",").map(function(e){return"("+e.replace("*",".*")+")"}).join("|"),t=new RegExp(t),l=s.validateAll.call(o,function(){for(var e=[],n=0,t=l.length;n<t;n++)r=l[n],e.push(r);return e}()),E=s.fileNameMatcher,F=s.fileMimeTypeMatcher,x=s.maxFileSize,i=!(m=[]),g=0,y=l.length;g<y;g++)r=l[g],p=s.validateEach(r)&&t.test(r.type)&&E.test(r.name)&&F.test(r.type)&&x>=r.size,m.push(p),p||(i=!0);if(i){if("error"===s.ifWrongFile)return o.value=null,void e.classList.add("error");if("nothing"===s.ifWrongFile)return void(o.value=null)}for(e.classList.add("drop"),L?L.innerHTML="":((L=document.createElement("div")).className="preview-container",e.append(L)),T=s.multiUploading,d=[],c=new Array(l.length),U=0,a="ignore"===s.ifWrongFile,f=v=0,M=l.length;0<=M?v<M:M<v;f=0<=M?++v:--v)if(m[f]||!a){let e=l[f],i=f,r=document.createElement("div");let a;if(r.className="wrapper uploading",L.append(r),m[f])if(r.innerHTML='<div class="preview"></div>\n<div class="file-name"></div>\n<div class="file-uploader-progress-bar">\n  <div class="progress"></div>\n</div>',b=(w=r.children)[0],w[1].textContent=e.name,a=w[2].children[0],N=function(t){if(n.push(function(){var e,n=function(e){return a.style.width=100*e.loaded/e.total+"%"};return T?(e=s.formData.call(o,i,t,c[i]),C(s,e,c[i],o,i,t,n).done(function(){if(r.classList.remove("uploading"),s.uploadEnd.call(o,c[i],i,t),++U===l.length)return s.done.call(o,c)})):(d.push(t),++U===l.length?(e=s.formData.call(o,d,c),C(s,e,c,o,"(multiUploading must be true)",d,n).done(function(){return s.uploadEnd.call(o,c,i,t),s.done.call(o,c)})):void 0)}),s.autoUpload)return n[n.length-1]()},c[i]=e.name,h=W(s.action,o,[f])){if("function"!=typeof(u=I[h.name])){if(null==h.name)throw new H('Please, specify "name" in "action" block');throw new H("There'no action with name \""+h.name+'"')}if(h.rename&&(w=(w=e.name.indexOf("."))<0?(D=e.name,""):(D=e.name.substr(0,w),e.name.substr(w)),c[i]=h.rename.call(o,D,w,i)),!h.params)throw new H('You should specify "params" in "action" option');u(s,h.params,b,e,N)}else N(e);else r.classList.add("invalid"),r.innerHTML=s.wrapperForInvalidFile.call(o,i)}return null}},C=function(e,n,t,i,r,a,o){return e.uploadBegin.call(i,t,r,a),e.ajaxSettings.call(i,n={method:"POST",cache:!1,contentType:!1,processData:!1,data:n,xhr:function(){var e=new XMLHttpRequest;return e.upload.onprogress=o,e}},r,t,a),n.url||(n.url=e.url),l.ajax(n)},e=function(e,a,o,l,s){var n,u=a.convertTo,t=new Image,h=document.createElement("canvas");return t.onload=function(e){var n,t,i,r;return a.preview&&o.append(h),r=this.width,n=this.height,u?(u.maxWidth||u.maxHeight?(t=u.maxWidth||this.width,i=u.maxHeight||this.height,"string"==typeof t&&(t=Number(t)),"string"==typeof i&&(i=Number(i)),t<r?i<(n*=(r=t)/this.width)&&(n=i,r=this.width*n/this.height):i<n&&t<(r*=(n=i)/this.height)&&(r=t,n=this.height*r/this.width),u.width&&u.width<t&&(r=u.width),u.height&&u.height<i&&(n=u.height)):(u.width&&(r=u.width),u.height&&(n=u.height)),h.width=r,h.height=n,h.getContext("2d").drawImage(this,0,0,r,n),(i=u.qualityArgument)&&1!=i||r!==this.width||n!==this.height||l.type===u.mimeType?(i=1===i?1.1:Number(i),h.toBlob(s,u.mimeType||l.type,i)):void s(l)):(h.width=r,h.height=n,h.getContext("2d").drawImage(this,0,0,r,n),void s(l))},(n=new FileReader).onloadend=function(e){return t.src=e.target.result},n.readAsDataURL(l)},I=l.fn.withDropZone.actions={image:e}}.call(this);