!function(h){h.fn.imageUploader=function(e){let s,t={preloaded:[],imagesInputName:"images",preloadedInputName:"preloaded",label:"Drag & Drop files here or click to browse",extensions:[".jpg",".jpeg",".png",".gif",".svg"],mimes:["image/jpeg","image/png","image/gif","image/svg+xml"],maxSize:void 0,maxFiles:void 0},o=this,d=new DataTransfer;o.settings={},o.init=function(){o.settings=h.extend(o.settings,t,e),o.each(function(e,t){let n=i();if(h(t).append(n),n.on("dragover",r.bind(n)),n.on("dragleave",r.bind(n)),n.on("drop",p.bind(n)),o.settings.preloaded.length){n.addClass("has-files");let t=n.find(".uploaded");for(let e=0;e<o.settings.preloaded.length;e++)t.append(a(o.settings.preloaded[e].src,o.settings.preloaded[e].id,!0))}})};let i=function(){let e=h("<div>",{class:"image-uploader"});s=h("<input>",{type:"file",id:o.settings.imagesInputName+"-"+n(),name:o.settings.imagesInputName+"[]",accept:o.settings.extensions.join(","),multiple:""}).appendTo(e),h("<div>",{class:"uploaded"}).appendTo(e);var t=h("<div>",{class:"upload-text"}).appendTo(e);return h("<i>",{class:"fas fa-cloud-upload-alt main-color"}).appendTo(t),h("<span>",{text:o.settings.label}).appendTo(t),e.on("click",function(e){l(e),s.trigger("click")}),s.on("click",function(e){e.stopPropagation()}),s.on("change",p.bind(e)),e},l=function(e){e.preventDefault(),e.stopPropagation()},a=function(e,n,t){let i=h("<div>",{class:"uploaded-image"}),a=(h("<img>",{src:e}).appendTo(i),h("<button>",{class:"delete-image"}).appendTo(i));return h("<i>",{class:"fa fa-times main-color"}).appendTo(a),t?(i.attr("data-preloaded",!0),h("<input>",{type:"hidden",name:o.settings.preloadedInputName+"[]",value:n}).appendTo(i)):i.attr("data-index",n),i.on("click",function(e){l(e)}),a.on("click",function(e){l(e);let t=i.parent();if(!0===i.data("preloaded"))o.settings.preloaded=o.settings.preloaded.filter(function(e){return e.id!==n});else{let n=parseInt(i.data("index"));t.find(".uploaded-image[data-index]").each(function(e,t){e>n&&h(t).attr("data-index",e-1)}),d.items.remove(n),s.prop("files",d.files)}i.remove(),t.children().length||t.parent().removeClass("has-files")}),i},r=function(e){l(e),"dragover"===e.type?h(this).addClass("drag-over"):h(this).removeClass("drag-over")},p=function(e){l(e);let t=h(this),n=Array.from(e.target.files||e.originalEvent.dataTransfer.files),i=[];h(n).each(function(e,t){o.settings.extensions&&!g(t)||o.settings.mimes&&!c(t)||o.settings.maxSize&&!f(t)||o.settings.maxFiles&&!m(i.length,t)||i.push(t)}),i.length?(t.removeClass("drag-over"),u(t,i)):s.prop("files",d.files)},g=function(e){return!(o.settings.extensions.indexOf(e.name.replace(new RegExp("^.*\\."),"."))<0&&(alert(`The file "${e.name}" does not match with the accepted file extensions: "${o.settings.extensions.join('", "')}"`),1))},c=function(e){return!(o.settings.mimes.indexOf(e.type)<0&&(alert(`The file "${e.name}" does not match with the accepted mime types: "${o.settings.mimes.join('", "')}"`),1))},f=function(e){return!(e.size>o.settings.maxSize&&(alert(`The file "${e.name}" exceeds the maximum size of ${o.settings.maxSize/1024/1024}Mb`),1))},m=function(e,t){return!(e+d.items.length+o.settings.preloaded.length>=o.settings.maxFiles&&(alert(`The file "${t.name}" could not be added because the limit of ${o.settings.maxFiles} files was reached`),1))},u=function(e,t){e.addClass("has-files");let n=e.find(".uploaded"),i=e.find('input[type="file"]');h(t).each(function(e,t){d.items.add(t),n.append(a(URL.createObjectURL(t),d.items.length-1),!1)}),i.prop("files",d.files)},n=function(){return Date.now()+Math.floor(100*Math.random()+1)};return this.init(),this}}(jQuery);